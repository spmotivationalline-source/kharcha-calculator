<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>रूम खर्चा कैलकुलेटर</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; }
        .member-card { transition: all 0.3s ease; }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-800 min-h-screen py-10">

    <main class="container mx-auto px-4">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-indigo-600 dark:text-indigo-400">रूम खर्चा कैलकुलेटर</h1>
            <p class="text-lg text-gray-600 dark:text-gray-300 mt-2">दोस्तों के बीच हिसाब-किताब, अब हुआ आसान!</p>
        </header>

        <div class="bg-white dark:bg-gray-700 p-6 md:p-8 rounded-xl shadow-lg">
            <div id="members-container">
                <!-- Shuruaat ke liye 2 member -->
                <div class="member-card grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 border-b dark:border-gray-600 pb-4">
                    <input type="text" placeholder="दोस्त का नाम (जैसे: Imteyaj)" class="name-input p-3 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white" required>
                    <input type="text" placeholder="सारे खर्चे कॉमा लगाकर लिखें (जैसे: 20, 50, 15)" class="expenses-input p-3 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white" required oninput="sanitizeExpenses(this)">
                </div>
                <div class="member-card grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 border-b dark:border-gray-600 pb-4">
                    <input type="text" placeholder="दोस्त का नाम (जैसे: Kausar)" class="name-input p-3 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white" required>
                    <input type="text" placeholder="सारे खर्चे कॉमा लगाकर लिखें (जैसे: 34, 56, 79)" class="expenses-input p-3 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white" required oninput="sanitizeExpenses(this)">
                </div>
            </div>

            <!-- Buttons -->
            <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 mt-6">
                <button onclick="addMember()" class="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg transition-colors">और दोस्त जोड़ें (+)</button>
                <button onclick="calculate()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg transition-colors">हिसाब करें (Calculate)</button>
            </div>
        </div>

        <!-- Result Section -->
        <div id="result-container" class="mt-8 bg-white dark:bg-gray-700 p-6 md:p-8 rounded-xl shadow-lg hidden">
            <h2 class="text-3xl font-bold text-center mb-6 text-indigo-600 dark:text-indigo-400">हिसाब का नतीजा</h2>
            
            <div id="summary" class="mb-6 border-b dark:border-gray-600 pb-4">
                <!-- Summary yahan aayega -->
            </div>
            
            <div id="transactions">
                <h3 class="text-2xl font-bold mb-4 text-center">किसको कितना देना है:</h3>
                <!-- Transactions ki list yahan aayegi -->
            </div>
        </div>

    </main>

    <script>
        function sanitizeExpenses(inputElement) {
            // Yeh function input me se number, comma, decimal, aur space ke alawa sab kuchh hata deta hai.
            const invalidCharsRegex = /[^0-9., ]/g;
            inputElement.value = inputElement.value.replace(invalidCharsRegex, '');
        }

        function addMember() {
            const container = document.getElementById('members-container');
            const newMemberCard = document.createElement('div');
            newMemberCard.className = 'member-card grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 border-b dark:border-gray-600 pb-4';
            newMemberCard.innerHTML = `
                <input type="text" placeholder="दोस्त का नाम" class="name-input p-3 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white" required>
                <input type="text" placeholder="सारे खर्चे कॉमा लगाकर लिखें" class="expenses-input p-3 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white" required oninput="sanitizeExpenses(this)">
            `;
            container.appendChild(newMemberCard);
        }

        function calculate() {
            const memberCards = document.querySelectorAll('.member-card');
            let membersData = [];
            let grandTotal = 0;

            memberCards.forEach(card => {
                const name = card.querySelector('.name-input').value.trim();
                const expensesStr = card.querySelector('.expenses-input').value.trim();

                if (name && expensesStr) {
                    const expensesArr = expensesStr.split(',')
                        .map(item => parseFloat(item.trim()))
                        .filter(num => !isNaN(num) && num > 0);
                    
                    const totalSpent = expensesArr.reduce((sum, current) => sum + current, 0);
                    
                    membersData.push({ name, totalSpent });
                    grandTotal += totalSpent;
                }
            });

            if (membersData.length === 0) {
                alert('कृपया कम से कम एक दोस्त की जानकारी भरें।');
                return;
            }

            const averageCost = grandTotal / membersData.length;

            membersData.forEach(member => {
                member.balance = member.totalSpent - averageCost;
            });

            // Hisab-kitab ka logic
            const debtors = membersData.filter(m => m.balance < 0).sort((a, b) => a.balance - b.balance);
            const creditors = membersData.filter(m => m.balance > 0).sort((a, b) => b.balance - a.balance);
            
            let transactions = [];

            let i = 0, j = 0;
            while(i < debtors.length && j < creditors.length) {
                const debtor = debtors[i];
                const creditor = creditors[j];
                const amount = Math.min(-debtor.balance, creditor.balance);

                transactions.push(`${debtor.name}, ${creditor.name} को <strong>${amount.toFixed(2)}</strong> रुपये देगा।`);

                debtor.balance += amount;
                creditor.balance -= amount;

                if (Math.abs(debtor.balance) < 0.01) i++;
                if (Math.abs(creditor.balance) < 0.01) j++;
            }
            
            // Result dikhayein
            displayResults(membersData, grandTotal, averageCost, transactions);
        }

        function displayResults(members, total, avg, transactions) {
            const resultContainer = document.getElementById('result-container');
            const summaryDiv = document.getElementById('summary');
            const transactionsDiv = document.getElementById('transactions');

            // Summary
            let summaryHTML = `<h3 class="text-2xl font-bold mb-4 text-center">हिसाब का सार</h3>`;
            summaryHTML += `<p class="text-lg text-center mb-2">कुल खर्च: <strong>${total.toFixed(2)} रुपये</strong></p>`;
            summaryHTML += `<p class="text-lg text-center mb-4">हर एक का हिस्सा: <strong>${avg.toFixed(2)} रुपये</strong></p>`;
            summaryHTML += `<div class="grid grid-cols-1 md:grid-cols-2 gap-4">`;
            members.forEach(m => {
                const balanceColor = m.balance >= 0 ? 'text-green-500' : 'text-red-500';
                summaryHTML += `
                    <div class="p-4 rounded-lg bg-gray-50 dark:bg-gray-600">
                        <p class="font-bold text-lg dark:text-white">${m.name}</p>
                        <p class="dark:text-gray-300">कुल खर्च किया: ${m.totalSpent.toFixed(2)}</p>
                        <p class="${balanceColor} font-semibold">
                            ${m.balance >= 0 ? `लेने हैं: ${m.balance.toFixed(2)}` : `देने हैं: ${(-m.balance).toFixed(2)}`}
                        </p>
                    </div>
                `;
            });
            summaryHTML += `</div>`;
            summaryDiv.innerHTML = summaryHTML;

            // Transactions
            let transactionsHTML = `<h3 class="text-2xl font-bold mb-4 text-center">किसको कितना देना है:</h3>`;
            if(transactions.length > 0) {
                transactionsHTML += `<ul class="space-y-3 text-center text-lg">`;
                transactions.forEach(t => {
                    transactionsHTML += `<li class="p-3 bg-indigo-100 dark:bg-indigo-900/50 rounded-lg dark:text-gray-200">${t}</li>`;
                });
                transactionsHTML += `</ul>`;
            } else {
                transactionsHTML += `<p class="text-center text-green-500 font-bold text-lg">सबका हिसाब बराबर है!</p>`;
            }
            transactionsDiv.innerHTML = transactionsHTML;
            
            resultContainer.classList.remove('hidden');
        }
    </script>

</body>
</html>

