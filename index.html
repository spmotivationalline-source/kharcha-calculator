<!DOCTYPE html>
<html lang="hi" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>प्रोफेशनल ग्रुप खर्चा कैलकुलेटर</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tiro+Devanagari+Hindi:wght@400;700&display=swap" rel="stylesheet">
    <style>
        html {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }
        body { 
            font-family: 'Tiro Devanagari Hindi', sans-serif; 
            background: #f0f4f8;
        }
        .dark body {
            background: #1e293b;
        }
        .card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .dark .card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .input-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
        }
        .member-card-enter {
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .member-card-enter-active {
            opacity: 1;
            transform: translateY(0);
        }
        #pdf-content {
             font-family: 'Tiro Devanagari Hindi', sans-serif;
        }
        /* Toggle Switch */
        .switch { position: relative; display: inline-block; width: 60px; height: 34px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; }
        .slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: .4s; }
        input:checked + .slider { background-color: #4f46e5; }
        input:checked + .slider:before { transform: translateX(26px); }
        .slider.round { border-radius: 34px; }
        .slider.round:before { border-radius: 50%; }
    </style>
</head>
<body class="dark:bg-slate-900 min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-indigo-50 to-blue-100 dark:from-gray-800 dark:to-gray-900">
    
    <!-- Menu Sidebar -->
    <div id="menu-sidebar" class="fixed top-0 left-0 w-72 h-full bg-white dark:bg-slate-800 shadow-xl z-[60] transform -translate-x-full transition-transform duration-300 ease-in-out">
        <div class="p-5">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-indigo-600 dark:text-indigo-400">Menu</h2>
                <button onclick="toggleMenu()" class="p-2 rounded-md hover:bg-gray-200 dark:hover:bg-slate-700">
                     <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="text-gray-700 dark:text-gray-300" viewBox="0 0 16 16">
                        <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
                    </svg>
                </button>
            </div>
            <ul class="space-y-2">
                <li><a href="#" onclick="openModal('profile-modal')" class="flex items-center gap-4 p-3 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-indigo-50 dark:hover:bg-slate-700 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16"><path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/><path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"/></svg>Profile</a></li>
                <li><a href="#" onclick="openModal('settings-modal')" class="flex items-center gap-4 p-3 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-indigo-50 dark:hover:bg-slate-700 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-gear-fill" viewBox="0 0 16 16"><path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311a1.464 1.464 0 0 1-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413-1.4-2.397 0-2.81l.34-.1a1.464 1.464 0 0 1 .872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"/></svg>Setting</a></li>
                <li><a href="#" onclick="openModal('about-modal')" class="flex items-center gap-4 p-3 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-indigo-50 dark:hover:bg-slate-700 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16"><path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/></svg>About Us</a></li>
                <li><a href="#" onclick="shareApp()" class="flex items-center gap-4 p-3 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-indigo-50 dark:hover:bg-slate-700 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-share-fill" viewBox="0 0 16 16"><path d="M11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.499 2.499 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5z"/></svg>Share app</a></li>
                <li><a href="#" onclick="contactUs()" class="flex items-center gap-4 p-3 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-indigo-50 dark:hover:bg-slate-700 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-headset" viewBox="0 0 16 16"><path d="M8 1a5 5 0 0 0-5 5v1h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V6a6 6 0 1 1 12 0v6a2.5 2.5 0 0 1-2.5 2.5H9.366a1 1 0 0 1-.866.5h-1a1 1 0 1 1 0-2h1a1 1 0 0 1 .866.5H11.5A1.5 1.5 0 0 0 13 12h-1a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1h1V6a5 5 0 0 0-5-5z"/></svg>Need Help? Contact Us</a></li>
            </ul>
        </div>
    </div>
    <div id="menu-overlay" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden" onclick="toggleMenu()"></div>

    <main id="calculator-container" class="w-full max-w-2xl mx-auto">
        <header class="mb-6">
            <div class="flex justify-between items-center">
                <!-- Left Column: Menu Button -->
                <div class="flex-1 flex justify-start">
                    <button id="menu-btn" onclick="toggleMenu()" class="p-2 rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <svg xmlns="http://www.w.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                </div>
                
                <!-- Center Column: Title -->
                <div class="flex-shrink-0 text-center">
                    <h1 class="text-3xl md:text-4xl font-bold text-indigo-600 dark:text-indigo-400 flex items-center justify-center gap-3">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-calculator-fill" viewBox="0 0 16 16" style="shape-rendering: geometricPrecision;">
                            <path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2zm2 .5v2a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 0-.5-.5h-7a.5.5 0 0 0-.5.5zm0 4v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5zM4.5 9a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1zM4 12.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5zM7.5 6a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1zM7 9.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5zm.5 2.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1zM10.5 6a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1zm-.5 3.5a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5zm.5 2.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1z"/>
                        </svg>
                        ग्रुप खर्चा कैलकुलेटर
                    </h1>
                </div>

                <!-- Right Column: History Button -->
                <div class="flex-1 flex justify-end">
                    <button id="history-btn" onclick="showHistoryPage()" class="flex items-center gap-2 bg-white dark:bg-slate-700 text-gray-700 dark:text-gray-300 font-bold py-2 px-4 rounded-lg shadow hover:bg-gray-100 dark:hover:bg-slate-600 transition-all">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M8.515 1.019A7 7 0 0 0 8 1V0a8 8 0 0 1 .589.022l-.074.997zm2.004.45a7.003 7.003 0 0 0-.985-.299l.219-.976c.383.086.76.2 1.126.342l-.36.933zm1.37.71a7.01 7.01 0 0 0-.439-.27l.493-.87a8.03 8.03 0 0 1 .979.654l-.615.789a6.996 6.996 0 0 0-.418-.302zm1.834 1.798a6.99 6.99 0 0 0-.653-.796l.724-.69c.27.285.52.59.747.91l-.818.575zm.53 1.292a6.99 6.99 0 0 0-.1-1.025l.985-.17c.067.386.106.778.116 1.17l-1 .025zm-.131 1.538c.033-.25.06-.5.076-.75l.974-.21a8.03 8.03 0 0 1-.92 2.16l-.904-.434zM8 1a7 7 0 0 0-7 7h1a6 6 0 0 1 6-6V1z"/><path d="M8 3.5a.5.5 0 0 1 .5.5V9a.5.5 0 0 1-.5.5H6a.5.5 0 0 1 0-1h1.5V4a.5.5 0 0 1 .5-.5z"/>
                        </svg>
                        History
                    </button>
                </div>
            </div>
            <p class="text-center text-md text-gray-600 dark:text-gray-400 mt-2">दोस्तों के बीच हिसाब-किताब, अब हुआ और भी आसान!</p>
        </header>

        <div class="card p-6 md:p-8 rounded-2xl shadow-lg">
            <div id="members-container" class="space-y-4"></div>
            <div class="flex flex-col sm:flex-row gap-3 mt-6">
                <button onclick="addMember()" class="w-full flex items-center justify-center gap-2 bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg transition-all transform hover:scale-105"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-person-plus-fill" viewBox="0 0 16 16" style="shape-rendering: geometricPrecision;"><path d="M1 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/><path fill-rule="evenodd" d="M13.5 5a.5.5 0 0 1 .5.5V7h1.5a.5.5 0 0 1 0 1H14v1.5a.5.5 0 0 1-1 0V8h-1.5a.5.5 0 0 1 0-1H13V5.5a.5.5 0 0 1 .5-.5z"/></svg>और दोस्त जोड़ें</button>
                <button id="calculate-btn" onclick="calculate()" class="w-full flex items-center justify-center gap-2 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition-all transform hover:scale-105 opacity-50 cursor-not-allowed" disabled><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-check-circle-fill" viewBox="0 0 16 16" style="shape-rendering: geometricPrecision;"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/></svg>हिसाब करें</button>
            </div>
        </div>

        <div id="result-container" class="mt-6 card p-6 md:p-8 rounded-2xl shadow-lg hidden">
            <h2 class="text-2xl font-bold text-center mb-6 text-indigo-600 dark:text-indigo-400">हिसाब का नतीजा</h2>
            <div id="summary" class="mb-6"></div>
            <div id="transactions"></div>
            <button onclick="resetCalculator()" class="w-full mt-6 flex items-center justify-center gap-2 bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-lg transition-all transform hover:scale-105"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-arrow-counterclockwise" viewBox="0 0 16 16" style="shape-rendering: geometricPrecision;"><path fill-rule="evenodd" d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2v1z"/><path d="M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308a.25.25 0 0 0 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466z"/></svg>रीसेट करें</button>
            <button id="generate-pdf-btn" onclick="showPdfPreview()" class="w-full mt-3 flex items-center justify-center gap-2 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg transition-all transform hover:scale-105"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-earmark-pdf-fill" viewBox="0 0 16 16"><path d="M5.523 12.424q.21-.164.479-.164.27 0 .479.164.21.164.21.434 0 .27-.21.434a.92.92 0 0 1-.48.164.92.92 0 0 1-.479-.164q-.21-.164-.21-.434t.21-.434zm3.424 0q.21-.164.48-.164.269 0 .479.164.21.164.21.434 0 .27-.21.434a.92.92 0 0 1-.48.164.92.92 0 0 1-.479-.164q-.21-.164-.21-.434t.21-.434z"/><path fill-rule="evenodd" d="M12 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zM4.5 5.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zM6 11.85a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v.15a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-.15zM7.5 5.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5z"/></svg>Generate PDF</button>
        </div>
    </main>

    <div id="history-container" class="hidden w-full max-w-2xl mx-auto">
        <div class="card p-6 md:p-8 rounded-2xl shadow-lg">
            <div class="flex justify-between items-center mb-6">
                <button onclick="showCalculator()" class="flex items-center gap-2 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-all transform hover:scale-105">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left-circle-fill" viewBox="0 0 16 16"><path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zm3.5 7.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5z"/></svg>
                    Back
                </button>
                <h2 class="text-2xl font-bold text-indigo-600 dark:text-indigo-400">हिसाब की History</h2>
                <div class="w-20"></div> <!-- Spacer -->
            </div>
            <div id="history-list" class="space-y-3">
                <!-- History items will be injected here -->
            </div>
        </div>
    </div>
    
    <div id="pdf-preview-container" class="hidden w-full max-w-4xl mx-auto">
         <div class="card p-4 sm:p-6 md:p-8 rounded-2xl shadow-lg">
             <div class="flex justify-between items-center mb-6">
                <button onclick="showCalculator()" class="flex items-center gap-2 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-all transform hover:scale-105">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left-circle-fill" viewBox="0 0 16 16"><path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zm3.5 7.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5z"/></svg>
                    Back
                </button>
                <h2 class="text-2xl font-bold text-indigo-600 dark:text-indigo-400">PDF Preview</h2>
                <button onclick="downloadPdf()" class="flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-all transform hover:scale-105">
                     <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-download" viewBox="0 0 16 16"><path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/><path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/></svg>
                    Download PDF
                </button>
            </div>
            <div id="pdf-content" class="bg-white dark:bg-gray-100 p-8 rounded-lg text-gray-800">
                <!-- PDF content will be injected here -->
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="profile-modal" class="fixed inset-0 bg-black bg-opacity-60 z-[70] hidden flex items-center justify-center p-4">
        <div class="card w-full max-w-md p-6 rounded-2xl shadow-lg text-center dark:text-white">
            <h2 class="text-2xl font-bold mb-4 text-indigo-600 dark:text-indigo-400">Profile</h2>
            <img src="https://placehold.co/100x100/6366f1/ffffff?text=MI" class="w-24 h-24 rounded-full mx-auto mb-4 border-4 border-white dark:border-slate-600">
            <p class="text-xl font-semibold">Md Imteyaj</p>
            <p class="text-gray-600 dark:text-gray-400">mdimteyaj091@gmail.com</p>
            <button onclick="closeModal('profile-modal')" class="mt-6 w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg">Close</button>
        </div>
    </div>

    <div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-60 z-[70] hidden flex items-center justify-center p-4">
        <div class="card w-full max-w-md p-6 rounded-2xl shadow-lg dark:text-white">
            <h2 class="text-2xl font-bold mb-6 text-center text-indigo-600 dark:text-indigo-400">Settings</h2>
            <div class="flex items-center justify-between">
                <span class="text-lg">Dark Mode</span>
                <label class="switch">
                    <input type="checkbox" id="dark-mode-toggle">
                    <span class="slider round"></span>
                </label>
            </div>
            <button onclick="closeModal('settings-modal')" class="mt-8 w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg">Close</button>
        </div>
    </div>
    
    <div id="about-modal" class="fixed inset-0 bg-black bg-opacity-60 z-[70] hidden flex items-center justify-center p-4">
        <div class="card w-full max-w-md p-6 rounded-2xl shadow-lg text-center dark:text-white">
            <h2 class="text-2xl font-bold mb-4 text-indigo-600 dark:text-indigo-400">About App</h2>
            <p class="text-gray-600 dark:text-gray-400">ग्रुप खर्चा कैलकुलेटर दोस्तों और परिवार के बीच खर्चों को बांटने का सबसे आसान तरीका है। बस सबका नाम और उनका खर्च डालें, और बाकी का हिसाब-किताब हम पर छोड़ दें!</p>
            <p class="mt-4 text-sm text-gray-500">Version 1.0.0</p>
            <button onclick="closeModal('about-modal')" class="mt-6 w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg">Close</button>
        </div>
    </div>

    <script>
        let appState = {
            members: [],
            total: 0,
            avg: 0,
            transactions: [],
            timestamp: null
        };
        
        // --- Dark Mode Logic ---
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const html = document.documentElement;
        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            html.classList.add('dark');
            darkModeToggle.checked = true;
        } else {
            html.classList.remove('dark');
            darkModeToggle.checked = false;
        }
        darkModeToggle.addEventListener('change', () => {
            if (darkModeToggle.checked) {
                html.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            } else {
                html.classList.remove('dark');
                localStorage.setItem('theme', 'light');
            }
        });

        document.addEventListener('DOMContentLoaded', loadInitialMembers);

        function toggleMenu() {
            const sidebar = document.getElementById('menu-sidebar');
            const overlay = document.getElementById('menu-overlay');
            sidebar.classList.toggle('-translate-x-full');
            overlay.classList.toggle('hidden');
        }

        // --- View Management ---
        function showCalculator() {
            document.getElementById('calculator-container').classList.remove('hidden');
            document.getElementById('pdf-preview-container').classList.add('hidden');
            document.getElementById('history-container').classList.add('hidden');
        }

        function showHistoryPage() {
            document.getElementById('calculator-container').classList.add('hidden');
            document.getElementById('pdf-preview-container').classList.add('hidden');
            document.getElementById('history-container').classList.remove('hidden');
            renderHistoryList();
        }

        function showPdfPreview() {
            document.getElementById('calculator-container').classList.add('hidden');
            document.getElementById('history-container').classList.add('hidden');
            document.getElementById('pdf-preview-container').classList.remove('hidden');
            document.body.scrollTop = 0;
            document.documentElement.scrollTop = 0;
            populatePdfContent();
        }

        // --- Modal Logic ---
        function openModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
            toggleMenu();
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        // --- Menu Actions ---
        function shareApp() {
            if (navigator.share) {
                navigator.share({
                    title: 'ग्रुप खर्चा कैलकुलेटर',
                    text: 'दोस्तों के साथ खर्चों का हिसाब करें आसानी से!',
                    url: window.location.href,
                }).catch(console.error);
            } else {
                alert('आपका ब्राउज़र शेयरिंग को सपोर्ट नहीं करता। आप लिंक कॉपी कर सकते हैं।');
            }
        }

        function contactUs() {
            window.location.href = 'mailto:mdimteyaj091@gmail.com?subject=Support Request for Group Kharcha Calculator';
        }

        // --- History Logic ---
        function saveCalculationToHistory() {
            const history = JSON.parse(localStorage.getItem('expenseHistory') || '[]');
            appState.timestamp = new Date().toISOString();
            history.push(appState);
            localStorage.setItem('expenseHistory', JSON.stringify(history));
        }

        function renderHistoryList() {
            const history = JSON.parse(localStorage.getItem('expenseHistory') || '[]');
            const historyListDiv = document.getElementById('history-list');
            historyListDiv.innerHTML = ''; // Clear previous list

            if (history.length === 0) {
                historyListDiv.innerHTML = `<p class="text-center text-gray-500 dark:text-gray-400">अभी तक कोई हिसाब नहीं किया गया है।</p>`;
                return;
            }

            history.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)); // Sort by date, newest first

            history.forEach((item, index) => {
                const date = new Date(item.timestamp);
                const formattedDate = date.toLocaleDateString('hi-IN', { year: 'numeric', month: 'long', day: 'numeric' });
                const formattedTime = date.toLocaleTimeString('hi-IN', { hour: '2-digit', minute: '2-digit' });
                
                const itemDiv = document.createElement('div');
                itemDiv.className = 'p-4 rounded-lg bg-gray-50 dark:bg-slate-700 shadow cursor-pointer hover:bg-indigo-50 dark:hover:bg-slate-600 transition-colors';
                itemDiv.onclick = () => viewHistoryDetail(index);
                itemDiv.innerHTML = `
                    <p class="font-bold text-lg dark:text-white">हिसाब: ${formattedDate}</p>
                    <p class="text-sm text-gray-600 dark:text-gray-400">${formattedTime}</p>
                    <p class="mt-2 font-semibold text-indigo-600 dark:text-indigo-400">कुल खर्च: ${item.total.toFixed(2)} रुपये</p>
                `;
                historyListDiv.appendChild(itemDiv);
            });
        }
        
        function viewHistoryDetail(index) {
            const history = JSON.parse(localStorage.getItem('expenseHistory') || '[]');
            // The list is rendered in reverse order, so we need to access the original array correctly
            history.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            const selectedState = history[index];
            if (selectedState) {
                appState = selectedState;
                showPdfPreview();
            }
        }


        // --- Calculator Logic ---
        function loadInitialMembers() {
            const container = document.getElementById('members-container');
            container.innerHTML = '';
            addMember();
            addMember();
        }

        function validateInputs() {
            const calculateBtn = document.getElementById('calculate-btn');
            const memberCards = document.querySelectorAll('.member-card-enter');
            let isAtLeastOneRowValid = false;

            if (memberCards.length < 1) { 
                isAtLeastOneRowValid = false;
            } else {
                for (const card of memberCards) {
                    const nameInput = card.querySelector('.name-input').value.trim();
                    const expensesInput = card.querySelector('.expenses-input').value.trim();
                    if (nameInput !== '' && expensesInput !== '') {
                        isAtLeastOneRowValid = true;
                        break; 
                    }
                }
            }

            if (isAtLeastOneRowValid) {
                calculateBtn.disabled = false;
                calculateBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            } else {
                calculateBtn.disabled = true;
                calculateBtn.classList.add('opacity-50', 'cursor-not-allowed');
            }
        }

        function removeMember(buttonElement) {
            buttonElement.closest('.member-card-enter').remove();
            validateInputs();
        }

        function sanitizeExpenses(inputElement) {
            inputElement.value = inputElement.value.replace(/[^0-9., ]/g, '');
            validateInputs();
        }

        function addMember() {
            const container = document.getElementById('members-container');
            const newMemberCard = document.createElement('div');
            newMemberCard.className = 'member-card-enter grid grid-cols-1 sm:grid-cols-2 gap-3 items-center';
            newMemberCard.innerHTML = `
                <div class="relative flex-grow"><span class="input-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-fill" viewBox="0 0 16 16" style="shape-rendering: geometricPrecision;"><path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg></span><input type="text" value="" placeholder="दोस्त का नाम" class="name-input w-full p-3 pl-10 border rounded-lg dark:bg-slate-700 dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-indigo-500 outline-none transition-all" oninput="validateInputs()"></div>
                <div class="relative flex-grow"><span class="input-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-currency-rupee" viewBox="0 0 16 16" style="shape-rendering: geometricPrecision;"><path d="M4 3.06h2.726c1.22 0 2.12.575 2.325 1.724H4v1.051h5.051C8.855 7.001 8 7.558 6.788 7.558H4v1.317L8.437 14h2.11L6.095 8.884h.855c2.316-.018 3.465-1.476 3.688-3.049H12V4.784h-1.345c-.08-.778-.357-1.335-.793-1.732H12V2H4v1.06Z"/></svg></span><div class="flex items-center"><input type="text" value="" placeholder="खर्चे (जैसे: 20, 50)" class="expenses-input w-full p-3 pl-10 border rounded-l-lg dark:bg-slate-700 dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-indigo-500 outline-none transition-all" oninput="sanitizeExpenses(this)"><button onclick="removeMember(this)" class="bg-red-500 hover:bg-red-600 text-white p-3 rounded-r-lg h-full"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-trash-fill" viewBox="0 0 16 16" style="shape-rendering: geometricPrecision;"><path d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1H2.5zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zm3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0z"/></svg></button></div></div>`;
            container.appendChild(newMemberCard);
            requestAnimationFrame(() => newMemberCard.classList.add('member-card-enter-active'));
            validateInputs();
        }

        function calculate() {
            const memberCards = document.querySelectorAll('.member-card-enter');
            let membersData = [];
            let grandTotal = 0;
            memberCards.forEach(card => {
                const name = card.querySelector('.name-input').value.trim();
                const expensesStr = card.querySelector('.expenses-input').value.trim();
                if (name && expensesStr) {
                    const expensesArr = expensesStr.split(/[ ,]+/).map(item => parseFloat(item.trim())).filter(num => !isNaN(num) && num > 0);
                    const totalSpent = expensesArr.reduce((sum, current) => sum + current, 0);
                    membersData.push({ name, totalSpent });
                    grandTotal += totalSpent;
                }
            });
            if (membersData.length < 2) {
                 alert('कम से कम दो दोस्तों का हिसाब करने के लिए जानकारी भरें।');
                 return;
            }
            const averageCost = grandTotal / membersData.length;
            membersData.forEach(member => member.balance = member.totalSpent - averageCost);
            const debtors = membersData.filter(m => m.balance < 0).sort((a, b) => a.balance - b.balance);
            const creditors = membersData.filter(m => m.balance > 0).sort((a, b) => b.balance - a.balance);
            let transactions = [];
            let i = 0, j = 0;
            while (i < debtors.length && j < creditors.length) {
                const debtor = debtors[i];
                const creditor = creditors[j];
                const amount = Math.min(-debtor.balance, creditor.balance);
                transactions.push({ from: debtor.name, to: creditor.name, amount: amount.toFixed(2) });
                debtor.balance += amount;
                creditor.balance -= amount;
                if (Math.abs(debtor.balance) < 0.01) i++;
                if (Math.abs(creditor.balance) < 0.01) j++;
            }
            appState = { members: membersData, total: grandTotal, avg: averageCost, transactions, timestamp: new Date().toISOString() };
            saveCalculationToHistory();
            displayResults();
        }

        function displayResults() {
            const { members, total, avg, transactions } = appState;
            const summaryDiv = document.getElementById('summary');
            const transactionsDiv = document.getElementById('transactions');

            let summaryHTML = `<div class="text-center mb-4 p-4 bg-indigo-50 dark:bg-indigo-900/50 rounded-lg"><p class="text-lg">कुल खर्च: <strong class="text-xl font-bold text-indigo-700 dark:text-indigo-300">${total.toFixed(2)} रुपये</strong></p><p class="text-lg">हर एक का हिस्सा: <strong class="text-xl font-bold text-indigo-700 dark:text-indigo-300">${avg.toFixed(2)} रुपये</strong></p></div><div class="grid grid-cols-1 sm:grid-cols-2 gap-4">`;
            members.forEach(m => {
                const balanceColor = m.balance >= 0 ? 'text-green-500' : 'text-red-500';
                summaryHTML += `<div class="p-4 rounded-lg bg-gray-50 dark:bg-slate-700 shadow"><p class="font-bold text-lg dark:text-white truncate">${m.name}</p><p class="dark:text-gray-300 text-sm">कुल खर्च: ${m.totalSpent.toFixed(2)}</p><p class="${balanceColor} font-semibold mt-1">${m.balance >= 0 ? `लेने हैं: ${m.balance.toFixed(2)}` : `देने हैं: ${(-m.balance).toFixed(2)}`}</p></div>`;
            });
            summaryHTML += `</div>`;
            summaryDiv.innerHTML = summaryHTML;

            let transactionsHTML = `<h3 class="text-xl font-bold text-center mt-6 mb-4 dark:text-white">लेन-देन का हिसाब:</h3>`;
            if (transactions.length > 0) {
                transactionsHTML += `<ul class="space-y-3 text-lg">`;
                transactions.forEach(t => transactionsHTML += `<li class="flex items-center justify-center gap-2 p-3 bg-gray-100 dark:bg-slate-700 rounded-lg dark:text-gray-200 text-center flex-wrap"><span class="font-semibold text-red-500">${t.from}</span><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-right-circle-fill text-indigo-500" viewBox="0 0 16 16"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0zM4.5 7.5a.5.5 0 0 0 0 1h5.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H4.5z"/></svg><span class="font-semibold text-green-500">${t.to}</span><span>को</span><strong class="font-bold text-indigo-600 dark:text-indigo-400">${t.amount} रुपये</strong><span>देगा।</span></li>`);
                transactionsHTML += `</ul>`;
            } else {
                transactionsHTML += `<p class="text-center text-green-500 font-bold text-lg p-4 bg-green-50 dark:bg-green-900/50 rounded-lg">सबका हिसाब बराबर है!</p>`;
            }
            transactionsDiv.innerHTML = transactionsHTML;
            
            const resultContainer = document.getElementById('result-container');
            resultContainer.classList.remove('hidden');
            resultContainer.scrollIntoView({ behavior: 'smooth' });
        }

        function resetCalculator() {
            showCalculator();
            loadInitialMembers();
            document.getElementById('result-container').classList.add('hidden');
            appState = { members: [], total: 0, avg: 0, transactions: [], timestamp: null };
        }

        function populatePdfContent() {
            const { members, total, avg, transactions, timestamp } = appState;
            const pdfContent = document.getElementById('pdf-content');
            
            const date = new Date(timestamp);
            const formattedDate = date.toLocaleDateString('hi-IN', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' });

            let html = `
                <div style="padding: 2rem; border: 1px solid #ddd; border-radius: 8px;">
                    <div style="text-align: center; margin-bottom: 1.5rem;">
                        <h1 style="color: #4338ca; font-size: 2em; margin-bottom: 0.5rem; font-weight: bold;">खर्च का हिसाब</h1>
                        <p style="font-size: 1em; color: #555;">${formattedDate}</p>
                    </div>
                    
                    <div style="background-color: #f3f4f6; padding: 1rem; border-radius: 8px; text-align: center; margin-bottom: 2rem;">
                        <p style="font-size: 1.1em; margin: 0.5rem 0;"><strong>कुल खर्च:</strong> ${total.toFixed(2)} रुपये</p>
                        <p style="font-size: 1.1em; margin: 0.5rem 0;"><strong>हर एक का हिस्सा:</strong> ${avg.toFixed(2)} रुपये</p>
                    </div>

                    <h2 style="font-size: 1.5em; margin-bottom: 1rem; color: #1e293b; border-bottom: 2px solid #6366f1; padding-bottom: 0.5rem; font-weight: bold;">किसने कितना खर्च किया</h2>
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 2rem; font-size: 1.1em;">
                        <thead>
                            <tr style="background-color: #e0e7ff;">
                                <th style="padding: 0.8rem; text-align: left; border-bottom: 1px solid #ccc; font-weight: bold;">नाम</th>
                                <th style="padding: 0.8rem; text-align: right; border-bottom: 1px solid #ccc; font-weight: bold;">खर्च की गई राशि</th>
                                <th style="padding: 0.8rem; text-align: right; border-bottom: 1px solid #ccc; font-weight: bold;">बकाया (देना/लेना)</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${members.map(m => `
                                <tr>
                                    <td style="padding: 0.8rem; border-bottom: 1px solid #eee;">${m.name}</td>
                                    <td style="padding: 0.8rem; text-align: right; border-bottom: 1px solid #eee;">${m.totalSpent.toFixed(2)}</td>
                                    <td style="padding: 0.8rem; text-align: right; border-bottom: 1px solid #eee; font-weight: bold; color: ${m.balance >= 0 ? '#16a34a' : '#dc2626'};">${m.balance.toFixed(2)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>

                    <h2 style="font-size: 1.5em; margin-bottom: 1rem; color: #1e293b; border-bottom: 2px solid #6366f1; padding-bottom: 0.5rem; font-weight: bold;">किसको कितना देना है</h2>
                    ${transactions.length > 0 ? `
                        <div style="padding: 0;">
                            ${transactions.map(t => `
                                <div style="background-color: #f3f4f6; padding: 1rem; border-radius: 8px; margin-bottom: 0.5rem; text-align: center; font-size: 1.1em; border: 1px solid #e5e7eb;">
                                    <span style="font-weight: bold; color: #dc2626;">${t.from}</span> &#8594; <span style="font-weight: bold; color: #16a34a;">${t.to}</span><span> को </span><strong style="color: #4338ca;">${t.amount} रुपये</strong><span> देगा।</span>
                                </div>
                            `).join('')}
                        </div>
                    ` : `<p style="text-align: center; font-size: 1.2em; color: #16a34a; background-color: #f0fdf4; padding: 1rem; border-radius: 8px;">सबका हिसाब बराबर है!</p>`}
                    
                    <div style="text-align: center; margin-top: 3rem; font-size: 0.8em; color: #888;">
                        <p>यह रिपोर्ट ग्रुप खर्चा कैलकुलेटर द्वारा बनाई गई है।</p>
                    </div>
                </div>`;

            pdfContent.innerHTML = html;
        }

        function downloadPdf() {
            const element = document.getElementById('pdf-content');
            const date = new Date(appState.timestamp);
            const fileName = `kharcha_hisab_${date.getFullYear()}-${date.getMonth()+1}-${date.getDate()}.pdf`;
            const opt = {
                margin:       0.5,
                filename:     fileName,
                image:        { type: 'png', quality: 1.0 },
                html2canvas:  { scale: 4, useCORS: true, logging: false },
                jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
            };
            html2pdf().from(element).set(opt).save();
        }
    </script>

</body>
</html>


